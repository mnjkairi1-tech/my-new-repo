{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user within the AI Atlas application, primarily for managing roles and permissions related to content submission and moderation. Authentication details (like passwords) are handled by an external system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserProfile entity."
        },
        "email": {
          "type": "string",
          "description": "The email address of the user, used for identification. The owner (mnjkairi1@gmail.com) will be identified by this email.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "The role of the user, determining their permissions within the application (e.g., 'owner', 'user'). The 'owner' role grants privileges to add and delete AI tools."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the user profile was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp indicating when the user profile was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "email",
        "role",
        "createdAt",
        "updatedAt"
      ]
    },
    "AICategory": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AICategory",
      "type": "object",
      "description": "Represents a category under which AI tools can be grouped (e.g., 'Image Generation', 'Video Editing'). Tools can be associated with one or more categories.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the AICategory entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the category (e.g., 'Video', 'Text-to-Speech')."
        },
        "description": {
          "type": "string",
          "description": "A brief description of the types of AI tools that belong to this category."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the category was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp indicating when the category was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "createdAt",
        "updatedAt"
      ]
    },
    "AITool": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AITool",
      "type": "object",
      "description": "Represents an individual AI tool listed in the AI Atlas directory, including its details, display properties, and categorization.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the AITool entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the AI tool (e.g., 'Runway', 'Pika')."
        },
        "description": {
          "type": "string",
          "description": "A concise description of the AI tool's primary functionality or purpose."
        },
        "websiteUrl": {
          "type": "string",
          "description": "The URL to the official website of the AI tool. This is the link that the owner would provide when adding a new tool.",
          "format": "uri"
        },
        "imageUrl": {
          "type": "string",
          "description": "The URL for the primary image of the tool, typically used for larger cards like those in 'Quick Tools' or 'Featured Card'.",
          "format": "uri"
        },
        "iconUrl": {
          "type": "string",
          "description": "The URL for a smaller icon representing the tool, often used in sections like 'Free popular tools'. Can be the same as 'imageUrl' or a distinct smaller icon.",
          "format": "uri"
        },
        "isFeatured": {
          "type": "boolean",
          "description": "A flag indicating if this tool should be prominently displayed in the 'Featured Card' section."
        },
        "isPopular": {
          "type": "boolean",
          "description": "A flag indicating if this tool should be listed in the 'Free popular tools' section."
        },
        "isActive": {
          "type": "boolean",
          "description": "A flag indicating whether the tool is currently active and visible to all users. Setting this to 'false' effectively 'deletes' the tool from public view without removing it from the database (soft delete)."
        },
        "categoryIds": {
          "type": "array",
          "description": "An array of IDs referencing the AICategory entities this tool belongs to. (Relationship: AICategory N:N AITool)",
          "items": {
            "type": "string"
          }
        },
        "ownerId": {
          "type": "string",
          "description": "Reference to the UserProfile ID of the user who submitted or 'owns' this tool. This will typically refer to the designated owner user (mnjkairi1@gmail.com). (Relationship: UserProfile 1:N AITool)"
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the AI tool was added to the directory.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp indicating when the AI tool's information was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "websiteUrl",
        "imageUrl",
        "iconUrl",
        "isFeatured",
        "isPopular",
        "isActive",
        "categoryIds",
        "ownerId",
        "createdAt",
        "updatedAt"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/userProfiles/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores individual user profiles. Access is restricted to the user whose ID matches the document ID. Primarily used for storing user-specific data and their role, though the 'owner' role for global permissions is primarily handled by the '/roles_owner' collection for Authorization Independence. Includes 'id', 'email', 'role', 'createdAt', 'updatedAt'."
        }
      },
      {
        "path": "/aiCategories/{categoryId}",
        "definition": {
          "entityName": "AICategory",
          "schema": {
            "$ref": "#/backend/entities/AICategory"
          },
          "description": "Contains metadata for AI tool categories. These documents are publicly readable by all users. Only the designated 'owner' (mnjkairi1@gmail.com, whose UID is present in '/roles_owner') can create, update, or delete category documents. Includes 'id', 'name', 'description', 'createdAt', 'updatedAt'.",
          "params": [
            {
              "name": "categoryId",
              "description": "The unique identifier for an AI category."
            }
          ]
        }
      },
      {
        "path": "/aiTools/{toolId}",
        "definition": {
          "entityName": "AITool",
          "schema": {
            "$ref": "#/backend/entities/AITool"
          },
          "description": "Stores details for each AI tool. Documents are publicly readable if 'isActive' is true, enabling QAPs for list operations. The 'ownerId' field explicitly denormalizes ownership (referencing the UID of 'mnjkairi1@gmail.com'), ensuring Authorization Independence for write operations. Only the designated 'owner' (checked via '/roles_owner' collection) can create, update, or set the 'isActive' status. Includes 'id', 'name', 'description', 'websiteUrl', 'imageUrl', 'iconUrl', 'isFeatured', 'isPopular', 'isActive', 'categoryIds', 'ownerId', 'createdAt', 'updatedAt'.",
          "params": [
            {
              "name": "toolId",
              "description": "The unique identifier for an AI tool."
            }
          ]
        }
      },
      {
        "path": "/roles_owner/{ownerUid}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "A collection used to explicitly mark users who have the 'owner' global role. A document exists for 'mnjkairi1@gmail.com''s UID. This collection enables Authorization Independence for global owner checks (e.g., for creating/managing tools/categories) by allowing security rules to perform a single, top-level existence check. Documents here typically contain minimal data, serving primarily as a presence indicator for the given UID.",
          "params": [
            {
              "name": "ownerUid",
              "description": "The unique identifier of a user who possesses the global 'owner' role."
            }
          ]
        }
      }
    ],
    "reasoning": "The recommended Firestore structure prioritizes Authorization Independence and Query-Accurate Permissions (QAPs) by employing structural segregation and denormalization. Authorization Independence: 1. Global Owner Role: A dedicated collection /roles_owner/{ownerUid} stores the UIDs of users with 'owner' privileges. This eliminates hierarchical authorization dependencies for global actions (like creating new tools or categories) by allowing security rules to perform a single get().exists() check on this top-level collection, completely independent of specific parent documents. This makes rules robust and easy to debug. The user identified as 'mnjkairi1@gmail.com' will have their UID stored here. 2. Tool Ownership Denormalization: Each /aiTools/{toolId} document explicitly includes an ownerId field, which will be the UID of the designated owner ('mnjkairi1@gmail.com'). This denormalization means that rules for modifying a specific tool do not need to get() any parent or user document to determine ownership. The ownership check is self-contained within the tool document, supporting atomic operations and preventing cascading rule failures. Query-Accurate Permissions (QAPs): 1. Structural Segregation for Tools: All AITool documents reside in a single /aiTools collection. Public readability is controlled by the isActive field within each tool document. Security rules will enforce that regular users can only list or get tools where isActive is true. This allows for efficient client-side queries (e.g., db.collection('aiTools').where('isActive', '==', true).get()) without requiring the rules to filter results, thus adhering to QAP principles. The 'owner' can bypass this isActive check. 2. Global Categories: /aiCategories are globally readable, ensuring that list operations for categories are always fully accurate and authorized. Write access is restricted to the owner via the /roles_owner collection. 3. User Profiles: /userProfiles/{userId} are segregated, with userId matching request.auth.uid, making individual profile management straightforward and secure through path-based authorization. Only the user themselves can read/write their own profile."
  }
}